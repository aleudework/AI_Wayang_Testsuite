USER_REQUEST: Create a Wayang plan that calculates waiting list totals for each municipality. The plan must filter the waiting list data for the month “2025-05” first. We want two values computed. The total per waiting list type and the overall total for the municipality. The output must be sorted in descending order by the municipality’s total. Output in textfile.
SQL_QUERY:
SELECT
    o.municipality,
    f.waiting_list_type,
    SUM(f.total) AS type_total,
    SUM(SUM(f.total)) OVER (PARTITION BY o.municipality) AS municipality_total
FROM factwaitinglists f
JOIN organisation o
    ON f.organisation_id = o.organisation_id
WHERE f.year_month = '2025-05'
GROUP BY
    o.municipality,
    f.waiting_list_type
ORDER BY
    municipality_total DESC,
    type_total DESC;


OUTPUT:
municipality,waiting_list_type,type_total,municipality_total
"Lyngby-Taarbæk Kommune","A1 Aktiv Ekstern",29395,55503
"Lyngby-Taarbæk Kommune","B1 Bero Ekstern",25374,55503
"Lyngby-Taarbæk Kommune","A0 Aktiv Intern",536,55503
"Lyngby-Taarbæk Kommune","B0 Bero Intern",198,55503
"Rødovre Kommune","A1 Aktiv Ekstern",21082,36420
"Rødovre Kommune","B1 Bero Ekstern",14189,36420
"Rødovre Kommune","A0 Aktiv Intern",815,36420
"Rødovre Kommune","B0 Bero Intern",334,36420