USER_REQUEST: Generate a Wayang plan that computes, for each nation and each year, the total profit for all parts whose name contains the substring ‘green’. Profit is defined as (l_extendedprice * (1 - l_discount)) - (ps_supplycost * l_quantity). Join the part, supplier, lineitem, partsupp, orders, and nation tables through their keys. Extract the order year, filter parts so that p_name contains ‘green’, and group the results by nation and year. Output in a textfile.
SQL_QUERY:
SELECT
    nation,
    o_year,
    SUM(amount) AS sum_profit
FROM (
    SELECT
        n.n_name AS nation,
        EXTRACT(YEAR FROM o.o_orderdate) AS o_year,
        (l.l_extendedprice * (1 - l.l_discount) - ps.ps_supplycost * l.l_quantity) AS amount
    FROM
        part p,
        supplier s,
        lineitem l,
        partsupp ps,
        orders o,
        nation n
    WHERE
        s.s_suppkey = l.l_suppkey
        AND ps.ps_suppkey = l.l_suppkey
        AND ps.ps_partkey = l.l_partkey
        AND p.p_partkey = l.l_partkey
        AND o.o_orderkey = l.l_orderkey
        AND s.s_nationkey = n.n_nationkey
        AND p.p_name LIKE '%green%'
) AS profit
GROUP BY
    nation,
    o_year;

OUTPUT:
nation,o_year,sum_profit
ALGERIA,1997,48611833.4962
ALGERIA,1998,27136900.1803
ARGENTINA,1992,46654240.7487
ARGENTINA,1993,48605593.6162
ARGENTINA,1994,48268856.3547
