USER_REQUEST: Identify all parts supplied by suppliers located in Germany whose individual stock value exceeds 0.0001 of the total stock value of all German suppliers. The stock value of each part is defined as ps_supplycost * ps_availqty. Use only suppliers from the nation ‘GERMANY’, compute the total stock value for Germany, and return only those parts whose value is greater than 0.0001 of that total. Output in Textfile.
SQL_QUERY:
SELECT
    ps_partkey,
    SUM(ps_supplycost * ps_availqty) AS value
FROM
    partsupp,
    supplier,
    nation
WHERE
    ps_suppkey = s_suppkey
    AND s_nationkey = n_nationkey
    AND n_name = 'GERMANY'
GROUP BY
    ps_partkey
HAVING
    SUM(ps_supplycost * ps_availqty) > (
        SELECT
            SUM(ps_supplycost * ps_availqty) * 0.0001
        FROM
            partsupp,
            supplier,
            nation
        WHERE
            ps_suppkey = s_suppkey
            AND s_nationkey = n_nationkey
            AND n_name = 'GERMANY'
    );

OUTPUT:
ps_partkey,value
222,13937777.74
325,8667741.28
424,8547527.10
755,8627091.68
952,8276136.00
966,8163824.79
1115,8184092.38