USER_REQUEST: Calculate the revenue loss for small-quantity orders for parts of brand ‘Brand#23’ and container type ‘MED BOX’ during the year 1996. A small order is defined as a lineitem whose quantity is less than 20% of the average quantity for that part. Compute the total gross (undiscounted) revenue of these small orders for the year 1996 and output the result in a textfile.
SQL_QUERY:
SELECT
    SUM(l.l_extendedprice) AS revenue_loss_1996
FROM
    lineitem l
    JOIN part p ON p.p_partkey = l.l_partkey
WHERE
    p.p_brand = 'Brand#23'
    AND p.p_container = 'MED BOX'
    AND l.l_shipdate >= DATE '1996-01-01'
    AND l.l_shipdate < DATE '1997-01-01'
    AND l.l_quantity < (
        SELECT
            0.2 * AVG(l2.l_quantity)
        FROM
            lineitem l2
        WHERE
            l2.l_partkey = p.p_partkey
    );

OUTPUT:
revenue_loss_1996
315301.43